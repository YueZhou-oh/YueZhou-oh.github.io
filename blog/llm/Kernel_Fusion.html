<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Fused Kernel</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="2e3d0db6-ce11-4e6f-8d01-1e4be9c6039c" class="page sans"><header><h1 class="page-title">Fused Kernel</h1><p class="page-description"></p></header><div class="page-body"><p id="853bcfdb-f5ee-4f3a-9496-7fd09bfe53ea" class="">
</p><nav id="25a0c03f-2f43-42cf-897b-87667932a9dd" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#d250dc02-12ca-4579-8c83-614aedb9dea9">LayerNorm</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#4666f7e0-e526-4f7d-9d9e-c702cae38f8d"><strong>LayerNorm è®¡ç®—æ–¹æ³•</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#61b9e44e-eec5-4ae4-bfe3-7d5c1d710acc"><strong>LayerNorm ä¸­æ±‚æ–¹å·®çš„æ–¹æ³•</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#44919dff-08f7-43e0-9219-18af6c0f7a83">ä¼˜åŒ–è®¡ç®—</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#2e220400-b399-4b8a-ba22-9377bfd385e0">Softmax</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#6e713396-956a-4f66-851d-fea777979beb">OneFlowå®ç°</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#0a57d56a-7c5e-48ff-a761-ce284120d8f3">Pytorchå®ç°</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#c930907b-d144-4aab-8388-ae726ae858f4">Bias_GeLU</a></div></nav><p id="493ebbb5-57bd-48ee-87c0-a184cd89ba1c" class="">
</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="6e917fb8-84fe-45a5-bd9c-8853e3747ba9"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">Softmax çš„ä¼˜åŒ–æ–¹æ³•ä¹Ÿé€‚ç”¨äº LayerNormï¼ŒLayerNorm çš„æ•°æ®ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºÂ <code>(num_rows, num_cols)</code>ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­å¯¹æ¯ä¸€è¡Œçš„å…ƒç´ åš Reduce æ“ä½œæ±‚å‡å€¼æ–¹å·®ã€‚å‡å°‘å¯¹global memoryçš„è®¿é—®æ¬¡æ•°</div></figure><h2 id="d250dc02-12ca-4579-8c83-614aedb9dea9" class="">LayerNorm</h2><p id="7df1c698-94a1-4933-ba0b-2cc0dca5745b" class="">
</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="6fdcbe8c-2350-4d84-b7ff-1c664a3f4ea5"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">transformerçš„layernormè®¡ç®—ç»´åº¦ï¼šHidden sizeç»´åº¦</div></figure><p id="0c91786b-bf7a-495f-8ef7-9a2d32a90437" class="">ä¼—å¤šæ¡†æ¶å‡å¯¹ç®—å­åšäº†ä¼˜åŒ–ï¼Œå¦‚ï¼š</p><ul id="fa95bc86-853e-48cb-ba16-9fb4d6a079af" class="bulleted-list"><li style="list-style-type:disc">NVIDIA Apex</li></ul><ul id="04c45a6e-5548-4136-a5b2-719b98c76204" class="bulleted-list"><li style="list-style-type:disc">Pytorch</li></ul><ul id="578ad75f-60f1-47a1-aeda-2be82dd59344" class="bulleted-list"><li style="list-style-type:disc">OneFlow</li></ul><p id="98253ac2-afac-4190-af8e-95b4e2b21cb5" class="">
</p><h3 id="4666f7e0-e526-4f7d-9d9e-c702cae38f8d" class=""><strong>LayerNorm è®¡ç®—æ–¹æ³•</strong></h3><p id="172328c8-ed0a-4915-8fa2-84e56d8a797b" class="">ä»¥ PyTorch ä¸ºä¾‹ï¼ŒLayerNorm çš„æ¥å£ä¸º:</p><p id="0efc2ec1-f54d-41b1-b295-5987edd7b60c" class=""><code>torch.nn.LayerNorm(normalized_shape, eps=1e-05, elementwise_affine=True, device=None, dtype=None)</code></p><ol type="1" id="a6e50aa3-596c-49c0-a873-f1b4f1fa6916" class="numbered-list" start="1"><li>å…¶ä¸­Â <code>input</code>Â å½¢çŠ¶ä¸ºï¼š<code>[âˆ—, normalized_shape[0], normalized_shape[1], â€¦,normalized_shape[âˆ’1]]</code></li></ol><ol type="1" id="c9d61aa7-22bc-4590-b647-200ffb4640a5" class="numbered-list" start="2"><li>ç¬¬ä¸€ä¸ªå‚æ•°Â <code>normalized_shape</code>Â åªèƒ½æ˜¯è¾“å…¥Â <code>x_shape</code>Â çš„åå‡ ç»´ï¼Œä¾‹å¦‚Â <code>x_shape</code>Â ä¸ºÂ <code>(N, C, H, W)</code>,Â <code>normalized_shape</code>Â å¯ä»¥æ˜¯Â <code>(W)</code>ï¼ŒÂ <code>(H, W)</code>Â ï¼Œ<code>(C, H, W)</code>Â æˆ–Â <code>(N, C, H, W)</code>ã€‚è¾“å…¥Â <code>x</code>Â åœ¨Â <code>normalized_shape</code>Â è¿™å‡ ç»´ä¸Šæ±‚å‡å€¼å’Œæ–¹å·®ã€‚</li></ol><ol type="1" id="3d110973-70c5-4b27-a25e-6abe02070925" class="numbered-list" start="3"><li>ç¬¬ä¸‰ä¸ªå‚æ•°Â <code>elementwise_affine</code>Â ä»£è¡¨æ˜¯å¦è¦å¯¹ normalize çš„ç»“æœåšå˜æ¢ï¼Œå³ normalize çš„ç»“æœä¹˜Â <code>gamma</code>ï¼ŒåŠ Â <code>beta</code>ã€‚è‹¥Â <code>elementwise_affine=True</code>ï¼Œå°±å¤šäº†ä¸¤ä¸ªæ¨¡å‹å‚æ•°Â <code>gamma</code>Â å’Œ<code>beta</code>ï¼Œå½¢çŠ¶ä¸ºÂ <code>normalized_shape</code>ã€‚</li></ol><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="bf87672a-baec-45ba-ac74-a84aaf47acbd"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">ä¾‹å¦‚å¯¹äºè¾“å…¥Â <code>x</code>Â å½¢çŠ¶ä¸ºÂ <code>(N, C, H, W)</code>ï¼ŒÂ <code>normalized_shape</code>Â ä¸ºÂ <code>(H, W)</code>Â çš„æƒ…å†µï¼Œå¯ä»¥ç†è§£ä¸ºè¾“å…¥Â <code>x</code>Â ä¸ºÂ <code>(N*C, H*W)</code>ï¼Œåœ¨Â <code>N*C</code>Â ä¸ªè¡Œä¸Šï¼Œæ¯è¡Œæœ‰Â <code>H*W</code>Â ä¸ªå…ƒç´ ï¼Œå¯¹æ¯è¡Œçš„å…ƒç´ æ±‚å‡å€¼å’Œæ–¹å·®ï¼Œå¾—åˆ°Â <code>N*C</code>Â ä¸ªÂ <code>mean</code>Â å’ŒÂ <code>inv_variance</code>ï¼Œå†å¯¹è¾“å…¥æŒ‰å¦‚ä¸‹ LayerNorm çš„è®¡ç®—å…¬å¼è®¡ç®—å¾—åˆ°Â <code>y</code>ã€‚è‹¥Â <code>elementwise_affine=True(default)</code>Â ï¼Œåˆ™æœ‰Â <code>H*W</code>Â ä¸ªÂ <code>gammaï¼ˆweightï¼‰</code>Â å’ŒÂ <code>beta(bias)</code>ï¼Œå¯¹æ¯è¡ŒÂ <code>H*W</code>Â ä¸ªçš„å…ƒç´ åšå˜æ¢ã€‚</div></figure><figure id="8f5d34e5-504b-4ace-8ffe-9fc66054dca6" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>y</mi><mo>=</mo><mfrac><mrow><mi>x</mi><mo>âˆ’</mo><mi>E</mi><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo></mrow><msqrt><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo><mo>+</mo><mi>Ïµ</mi></mrow></msqrt></mfrac><mo>âˆ—</mo><mi>Î³</mi><mo>+</mo><mi>Î²</mi></mrow><annotation encoding="application/x-tex">y=\frac {x-E[x]}{\sqrt {Var[x]+\epsilon}}*\gamma + \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.557em;vertical-align:-1.13em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.175em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">Ïµ</span></span></span><span style="top:-2.895em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.305em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mclose">]</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span></span></span></span></span></div></figure><figure id="c71043a7-bac8-4d24-afda-0a47ea4dab1c" class="image"><a href="Kernel_Fusion/Untitled.png"><img style="width:600px" src="Kernel_Fusion/Untitled.png"/></a></figure><figure id="9c15b11c-bfbe-4580-a0d4-463a3d90bafa" class="image"><a href="Kernel_Fusion/Untitled%201.png"><img style="width:762px" src="Kernel_Fusion/Untitled%201.png"/></a></figure><h3 id="61b9e44e-eec5-4ae4-bfe3-7d5c1d710acc" class=""><strong>LayerNorm ä¸­æ±‚æ–¹å·®çš„æ–¹æ³•</strong></h3><p id="0805dc6b-00f9-4c32-81b7-6ff9f2e54df5" class="">å¸¸è§çš„æ±‚æ–¹å·®çš„æ–¹æ³•æœ‰ two pass æ–¹æ³•ã€naive æ–¹æ³•ã€å’Œ Welford ç®—æ³•ï¼Œæœ¬æ–‡æ‘˜å½•ä¸€äº›å…³é”®çš„å…¬å¼å’Œç»“è®ºï¼Œè¯¦ç»†çš„ä»‹ç»å’Œæ¨å¯¼å¯å‚è€ƒï¼š<a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Algorithms_for_calculating_variance">Wiki: Algorithms for calculating variance</a>Â ï¼Œå’ŒÂ <a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/t0x782mDkMo-ZBVEbK8gPg">GiantPandaCV: ç”¨Welfordç®—æ³•å®ç°LNçš„æ–¹å·®æ›´æ–°</a></p><ul id="39535d70-da99-4e67-92db-f42376ea567d" class="bulleted-list"><li style="list-style-type:disc">two-passæ–¹æ³•</li></ul><p id="44c10de3-b3a8-40fa-bd92-06bc8bad3981" class="">ä½¿ç”¨çš„å…¬å¼æ˜¯ï¼š</p><figure id="c1f7e5a4-1209-4106-81a4-be3fbda6b87a" class="image"><a href="https://pic3.zhimg.com/80/v2-292bfd502d9e5eb1558a68d06fdd365e_1440w.webp"><img style="width:424px" src="https://pic3.zhimg.com/80/v2-292bfd502d9e5eb1558a68d06fdd365e_1440w.webp"/></a></figure><p id="34a78475-451e-4c62-ab19-cdc0aa87e6ba" class="">two-pass æ˜¯æŒ‡è¿™ç§æ–¹æ³•éœ€è¦éå†ä¸¤éæ•°æ®ï¼Œç¬¬ä¸€éç´¯åŠ Â <code>x</code>Â å¾—åˆ°å‡å€¼ï¼Œç¬¬äºŒéç”¨ä¸Šé¢å…¬å¼è®¡ç®—å¾—åˆ°æ–¹å·®ã€‚è¿™ç§æ–¹æ³•åœ¨Â <code>n</code>Â æ¯”è¾ƒå°æ—¶ä»ç„¶æ˜¯æ•°å€¼ç¨³å®šçš„ã€‚</p><ul id="3551b83a-f0cd-4180-b0c7-6e10a4e63e44" class="bulleted-list"><li style="list-style-type:disc">naiveæ–¹æ³•</li></ul><p id="16108a5d-b7a6-4120-b7a2-dc7675f8fe1f" class="">ä½¿ç”¨çš„å…¬å¼æ˜¯ï¼š</p><figure id="0239f96e-4420-4157-b423-d662f8effad9" class="image"><a href="https://pic2.zhimg.com/80/v2-ac64490783716dc686e5e631668a6b21_1440w.webp"><img style="width:648px" src="https://pic2.zhimg.com/80/v2-ac64490783716dc686e5e631668a6b21_1440w.webp"/></a></figure><p id="d12e0d51-f00c-48e1-83b8-19c5aa71b415" class="">è¿™ç§æ–¹æ³•æ˜¯ä¸€ç§ single pass æ–¹æ³•ï¼Œåœ¨è®¡ç®—æ–¹å·®æ—¶åªéœ€è¦éå†ä¸€éæ•°æ®ç´¯åŠ Â <code>x</code>Â çš„å¹³æ–¹åŠç´¯åŠ Â <code>x</code>ï¼Œæœ€åæŒ‰ä¸Šè¿°å…¬å¼è®¡ç®—å¾—åˆ°æ–¹å·®ã€‚è¿™ç§æ–¹æ³•åªéœ€è¦éå†ä¸€éæ•°æ®ï¼Œç›¸æ¯” two-pass çš„ç®—æ³•ï¼Œæ›´å®¹æ˜“è¾¾åˆ°å¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯ä¸Šé¢çš„ Wiki å‚è€ƒé“¾æ¥ä¸­ä»‹ç»ç”±äº SumSquare å’Œ (SumÃ—Sum)/n å¯èƒ½éå¸¸æ¥è¿‘ï¼Œå¯èƒ½ä¼šå¯¼è‡´è®¡ç®—ç»“æœæŸå¤±ç²¾åº¦è¾ƒå¤§ï¼Œå› æ­¤è¿™ç§æ–¹æ³•ä¸å»ºè®®åœ¨å®è·µä¸­ä½¿ç”¨ã€‚</p><ul id="f31a2a63-2f0d-490c-845d-b5ff0e9f6748" class="bulleted-list"><li style="list-style-type:disc">Welford ç®—æ³•ä½¿ç”¨çš„å…¬å¼æ˜¯ï¼š</li></ul><figure id="8d30dd1a-75d9-447f-aeb0-0a660562be1f" class="image"><a href="https://pic4.zhimg.com/80/v2-a72771a9d2b9ab01b3d7243d90cb2ba7_1440w.webp"><img style="width:626px" src="https://pic4.zhimg.com/80/v2-a72771a9d2b9ab01b3d7243d90cb2ba7_1440w.webp"/></a></figure><p id="0436a3be-d2dd-4d63-bd63-821179460acb" class="">Welford ç®—æ³•ä¹Ÿæ˜¯ä¸€ç§ <mark class="highlight-yellow_background">single pass æ–¹æ³•(è®¡ç®—å‡å€¼å’Œæ–¹å·®æ—¶åªéœ€è¦éå†ä¸€éæ•°æ®)ï¼Œä¸”æ•°å€¼ç¨³å®šæ€§å¾ˆå¥½ï¼ˆnæ¯”è¾ƒå°æ—¶ï¼‰</mark>ï¼Œå› æ­¤ç°åœ¨å¾ˆå¤šæ¡†æ¶éƒ½é‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚æœ¬æ–‡çš„ä»£ç ä¸­é‡‡ç”¨çš„ä¹Ÿæ˜¯ Welford æ–¹æ³•ã€‚</p><p id="09d44f16-2c1c-4c34-8beb-6b217d9ede63" class="">
</p><h3 id="44919dff-08f7-43e0-9219-18af6c0f7a83" class="">ä¼˜åŒ–è®¡ç®—</h3><p id="c6008f69-8ec6-473b-bf66-af9abb1ac341" class="">èƒŒæ™¯ï¼štransformerä¸­é€šå¸¸å¯¹æœ€åä¸€ç»´è®¡ç®—normalization</p><ul id="1fe899a7-14a4-42bb-bfe9-46b290f02e06" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-red">baseï¼šå‘é‡åŒ–è®¿å­˜VMAï¼Œå•æ¬¡instructionä»¥æ›´é«˜çš„bitsç²¾åº¦è®¿é—®å’Œå­˜å‚¨æ•°æ®ï¼Œæé«˜ CUDA Kernel æ€§èƒ½ï¼Œå¾ˆå¤š CUDA Kernel éƒ½æ˜¯bandwidth boundçš„ï¼Œä½¿ç”¨VMAå¯ä»¥å‡å°‘æ€»çš„æŒ‡ä»¤æ•°ï¼Œå‡å°‘å»¶è¿Ÿï¼Œæé«˜å¸¦å®½åˆ©ç”¨ç‡ã€‚</mark><blockquote id="cec2e37c-7817-40a9-ac0e-33d9914bdd12" class=""><mark class="highlight-red">load and store data but do so in 64- or 128-bit widths. Using vectorized loads reduces the total number of instructions, reduces latency, and improves bandwidth utilization.</mark></blockquote></li></ul><ul id="81e9bc83-2225-486d-a784-ca6cb372c117" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-red">å½“normalized shape/hidden sizeä¸å¤§æ—¶ï¼Œå……åˆ†åˆ©ç”¨shared memoryä¿å­˜ä¸­é—´çš„allreduceç»“æœï¼›æ ¹æ®n_colçš„å¤§å°å†³å®šä»¥warpè¿˜æ˜¯blockä¸ºå•ä½è®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼›é€šè¿‡ä¸€æ¬¡allreduceæ›´æ–°æ‰€æœ‰threadçš„è®¡ç®—ç»“æœã€‚</mark></li></ul><ul id="1f80dc04-4768-4337-9d78-3dd682dbb290" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-red">ä½¿ç”¨single passçš„Welford ç®—æ³•è®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼Œå‡å°‘æ•°æ®éå†æ¬¡æ•°ï¼Œä¸”æ•°å€¼ç¨³å®šæ€§å¾ˆå¥½</mark></li></ul><p id="34fca9e1-d9ca-44d6-94eb-7e55efff3f61" class="">
</p><figure id="54cebd20-2ec4-448e-86c0-6b61ac058280" class="image"><a href="Kernel_Fusion/Untitled%202.png"><img style="width:950px" src="Kernel_Fusion/Untitled%202.png"/></a></figure><p id="a5f96bc7-2801-487f-8349-7fbf5e58cc8e" class="">
</p><figure id="8df5d466-da84-4946-bd0a-cb840c5cae54"><a href="https://developer.nvidia.com/blog/cuda-pro-tip-increase-performance-with-vectorized-memory-access/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">CUDA Pro Tip: Increase Performance with Vectorized Memory Access | NVIDIA Technical Blog</div><div class="bookmark-description">This post demonstrates the use of vectorized memory access in CUDA C/C++ to increase bandwidth utilization while decreasing instruction count.</div></div><div class="bookmark-href"><img src="https://developer-blogs.nvidia.com/wp-content/themes/nvidia/dist/images/favicon_300a1064.ico" class="icon bookmark-icon"/>https://developer.nvidia.com/blog/cuda-pro-tip-increase-performance-with-vectorized-memory-access/</div></div><img src="https://developer-blogs.nvidia.com/wp-content/uploads/2017/02/GPU-Pro-Tip.png" class="bookmark-image"/></a></figure><figure id="e4ff79aa-2b78-4641-a3ba-1746352a6836"><a href="https://zhuanlan.zhihu.com/p/443026261" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">CUDAä¼˜åŒ–ä¹‹LayerNormæ€§èƒ½ä¼˜åŒ–å®è·µ</div><div class="bookmark-description">æ’°æ–‡ | éƒ­å†‰ã€å§šè¿Ÿã€éƒ‘æ³½åº·ã€æŸ³ä¿Šä¸2020 å¹´æœ«ï¼ŒOneFlow å‘å¸ƒäº†ã€Š OneFlowæ€§èƒ½ä¼˜åŒ–åˆ†äº«ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªé«˜æ•ˆçš„ Softmax CUDA kernelï¼Ÿã€‹ï¼Œå…¶ä¸­ä»‹ç»äº† OneFlow æ·±åº¦ä¼˜åŒ–åçš„ Softmaxï¼Œå°¤å…¶å¯¹å¾ˆå¤šæ¡†æ¶æ²¡æœ‰è€ƒè™‘çš„ half â€¦</div></div><div class="bookmark-href"><img src="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.81060cab.png" class="icon bookmark-icon"/>https://zhuanlan.zhihu.com/p/443026261</div></div><img src="https://pic1.zhimg.com/v2-c7c92b1bd6624c9c1e86afb737ea437f_720w.jpg?source=172ae18b" class="bookmark-image"/></a></figure><p id="7d1a09af-2ac0-4b80-8a06-7550ad0d179a" class="">
</p><h2 id="2e220400-b399-4b8a-ba22-9377bfd385e0" class="">Softmax</h2><ul id="2b28f618-8f4e-4e35-9f56-d6af6c6a0311" class="bulleted-list"><li style="list-style-type:disc">å°½ç®¡å½“Softmaxå’ŒCrossEntropyè”åˆä½¿ç”¨æ—¶ï¼Œå…¶æ•°å­¦æ¨å¯¼å¯ä»¥çº¦ç®€ï¼Œç®€åŒ–è®¡ç®—</li></ul><ul id="ac5af165-26a7-4c59-afa2-622b0f7947af" class="bulleted-list"><li style="list-style-type:disc">ä½†è¿˜æ˜¯æœ‰å¾ˆå¤šåœºæ™¯ä¼šå•ç‹¬ä½¿ç”¨Softmax Opï¼Œå¦‚è®¡ç®—attention mapæ—¶</li></ul><p id="fe77582b-eefa-4ca3-9d8b-b3d21e51ac99" class="">
</p><p id="3038136c-9e46-4675-9067-891d36b62e29" class="">Naive Softmax ï¼ˆæ³¨ï¼šå…ˆå‡æœ€å¤§å€¼ï¼Œé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ï¼Ÿï¼‰ï¼š</p><ol type="1" id="e96538da-9300-4046-87b1-7fdb43e033c5" class="numbered-list" start="1"><li>å…ˆåšä¸€ä¸ª ReduceMax æ±‚æœ€å¤§å€¼æ“ä½œï¼Œå¾—åˆ°è¾“å…¥æ¯ä¸€è¡Œçš„æœ€å¤§å€¼ï¼›</li></ol><ol type="1" id="53dfbceb-c3f2-4736-83cd-c3511f111460" class="numbered-list" start="2"><li>ç„¶ååšä¸€ä¸ª BroadcastSub å‡æ³•æ“ä½œï¼Œæ‹¿è¾“å…¥æ¯ä¸€è¡Œçš„å„ç‚¹å‡å»æ¯ä¸€è¡Œçš„æœ€å¤§å€¼ï¼Œå³å¸¸è§çš„softmaxè¡¨è¾¾å¼ä¸­çš„è¾“å…¥x;</li></ol><ol type="1" id="2dc74f5e-675e-4a89-9d9f-7b57ecac4c7c" class="numbered-list" start="3"><li>ç„¶ååšä¸€ä¸ª è‡ªç„¶æŒ‡æ•° Exp æ“ä½œï¼Œå¯¹è¾“å…¥æ¯ä¸€è¡Œçš„å„ç‚¹è®¡ç®—æŒ‡æ•°;</li></ol><ol type="1" id="ee0b81b9-a691-4dac-80ca-62d6f672b913" class="numbered-list" start="4"><li>ç„¶ååšä¸€ä¸ª ReduceSum æ±‚å’Œæ“ä½œï¼Œå¯¹è¾“å…¥æ¯ä¸€è¡Œçš„æ‰€æœ‰ç»“æœæ±‚å’Œï¼Œå¾—åˆ°å‰é¢å…¬å¼å®šä¹‰çš„Â ;</li></ol><ol type="1" id="cc21c2a3-9a72-4d08-8c0e-1613d7e42348" class="numbered-list" start="5"><li>æœ€ååšä¸€ä¸ª BroadcastDiv é™¤æ³•æ“ä½œï¼Œ æ‹¿è¾“å…¥æ¯ä¸€è¡Œçš„å„ç‚¹çš„è¾“å‡ºï¼›</li></ol><p id="37646c28-b5b3-44f4-ad52-110a5e5f3c8d" class="">
</p><p id="835ec050-c493-4afe-a6b9-87995c0b24e2" class="">å‡è®¾è¾“å…¥çš„æ•°æ®å¤§å°ä¸º<code>D</code>ï¼Œ<code>shape = (num_rows, num_cols)</code>, å³Â <code>D = num_rows * num_cols</code>ï¼Œæœ€Navieçš„æ“ä½œä¼šå¤šæ¬¡è®¿é—®Global memoryï¼Œå…¶ä¸­ï¼š</p><ul id="9010d240-2fa8-4fa1-aab1-e9d3cf618017" class="bulleted-list"><li style="list-style-type:disc">ReduceMax =Â <code>D + num_rows</code>Â ï¼ˆread ä¸º Dï¼Œ write ä¸º num_rowsï¼‰</li></ul><ul id="15369ca6-314f-49d6-b26d-ca07f41adbcf" class="bulleted-list"><li style="list-style-type:disc">BroadcaseSub =Â <code>2 * D + num_rows</code>Â ï¼ˆread ä¸º D + num_rowsï¼Œwrite ä¸º Dï¼‰</li></ul><ul id="3f31590e-94af-4e94-b983-a2621996b8ce" class="bulleted-list"><li style="list-style-type:disc">Exp =Â <code>2 * D</code>Â ï¼ˆread ã€write å‡ä¸ºDï¼‰</li></ul><ul id="86ad4f8e-7707-4ce9-9351-05856915ffc1" class="bulleted-list"><li style="list-style-type:disc">ReduceSum =Â <code>D + num_rows</code>ï¼ˆread ä¸º Dï¼Œ write ä¸º num_rowsï¼‰</li></ul><ul id="aff93128-96a2-4737-8cd7-a51a3aff9ba0" class="bulleted-list"><li style="list-style-type:disc">BroadcastDive =Â <code>2 * D + num_rows</code>Â ï¼ˆread ä¸º D + num_rowsï¼Œ write ä¸º Dï¼‰</li></ul><p id="0bbe53f3-c1db-43e1-9554-20ef94bb478c" class="">æ€»å…±éœ€è¦<code>8 * D + 4 * num_rows</code>Â çš„è®¿å­˜å¼€é”€ã€‚ç”±äºnum_rowsç›¸æ¯”äºDå¯ä»¥å¿½ç•¥ï¼Œåˆ™Navieç‰ˆæœ¬çš„Softmax CUDA Kerneléœ€è¦è®¿é—®è‡³å°‘8å€æ•°æ®çš„æ˜¾å­˜ï¼Œå³ï¼š $$ Naive Softmax Kernel æœ‰æ•ˆæ˜¾å­˜å¸¦å®½ &lt; ç†è®ºå¸¦å®½ / 8 $$ å¯¹äºGeForce RTXâ„¢ 3090æ˜¾å¡ï¼Œå…¶ç†è®ºå¸¦å®½ä¸Šé™ä¸º<strong>936</strong>GB/sï¼Œé‚£ä¹ˆNavieç‰ˆæœ¬çš„Softmax CUDA Kernelåˆ©ç”¨æ˜¾å­˜å¸¦å®½çš„ä¸Šç•Œå°±æ˜¯936 / 8 = 117 GB/sã€‚</p><h3 id="6e713396-956a-4f66-851d-fea777979beb" class="">OneFlowå®ç°</h3><p id="d2b1a3d6-051a-4521-8e36-70be97253b39" class=""><mark class="highlight-red">ä¸LayerNormï¼Œæ ¸å¿ƒæ€æƒ³ä¸€è‡´ï¼Œå¦‚ä½•æ›´é«˜æ•ˆçš„å¤„ç†è¡Œè®¡ç®—ï¼Œ</mark>åˆ†æ®µå¯¹ softmax è¿›è¡Œä¼˜åŒ–ï¼š</p><p id="88e83feb-c9b0-4b08-a659-4d4b288bbd1a" class="">(1) ä¸€ä¸ªÂ <strong>Warp</strong>Â å¤„ç†ä¸€è¡Œçš„è®¡ç®—ï¼Œé€‚ç”¨äº num_cols &lt;= 1024 æƒ…å†µ</p><p id="2cdde6fb-4d25-480c-9683-d6e5a2032987" class="">(2) å½“num_colsä¸­ç­‰æ—¶ï¼Œä¸€ä¸ª Block å¤„ç†ä¸€è¡Œçš„è®¡ç®—ï¼Œå€ŸåŠ© Shared Memory ä¿å­˜ä¸­é—´ç»“æœæ•°æ®ï¼Œ1024 &lt; num_cols &lt;= 4096</p><p id="188dccb8-2a95-441a-9dd8-e0450b763d00" class="">(3) å½“num_colå¾ˆå¤§æ—¶ï¼Œä¸€ä¸ª Block å¤„ç†ä¸€è¡Œçš„è®¡ç®—ï¼Œä¸ä½¿ç”¨ Shared Memoryï¼Œé‡å¤è¯»è¾“å…¥ x</p><p id="b7e67c51-be33-4a90-903f-22c28f19a923" class="">(4) å‘é‡åŒ–è®¿å­˜</p><p id="36a57610-b28c-4983-a56a-4b750c5c9c73" class="">
</p><h3 id="0a57d56a-7c5e-48ff-a761-ce284120d8f3" class="">Pytorchå®ç°</h3><p id="7a91a412-115c-492a-8e20-fd429298c606" class="">ä¸OneFlowçš„å‰ä¸¤ç§ä¸€è‡´ï¼Œåˆ†åˆ«å¯¹åº”cunn_SoftMaxForwardï¼Œå’Œsoftmax_warp_forwardï¼›</p><p id="18e2c15f-bf33-4e69-853e-d6cabd2f1cce" class="">
</p><figure id="b9be5290-5297-4364-be2b-df88002eaabe" class="image"><a href="Kernel_Fusion/Untitled%203.png"><img style="width:644px" src="Kernel_Fusion/Untitled%203.png"/></a></figure><figure id="21fbd67a-52c3-40c5-988c-21120ba9067f"><a href="https://zhuanlan.zhihu.com/p/341059988" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">å¦‚ä½•å®ç°ä¸€ä¸ªé«˜æ•ˆçš„Softmax CUDA kernelï¼Ÿâ€”â€”OneFlow æ€§èƒ½ä¼˜åŒ–åˆ†äº«</div><div class="bookmark-description">æ’°æ–‡ ï½œ éƒ­å†‰Softmaxæ“ä½œæ˜¯æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­æœ€å¸¸ç”¨çš„æ“ä½œä¹‹ä¸€ã€‚åœ¨æ·±åº¦å­¦ä¹ çš„åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œç½‘ç»œæœ€åçš„åˆ†ç±»å™¨å¾€å¾€æ˜¯Softmax + CrossEntropyçš„ç»„åˆï¼š å°½ç®¡å½“Softmaxå’ŒCrossEntropyè”åˆä½¿ç”¨æ—¶ï¼Œå…¶æ•°å­¦æ¨å¯¼å¯ä»¥çº¦ç®€ï¼Œä½†è¿˜â€¦</div></div><div class="bookmark-href"><img src="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.81060cab.png" class="icon bookmark-icon"/>https://zhuanlan.zhihu.com/p/341059988</div></div><img src="https://picx.zhimg.com/v2-0079316e5a4905a798b27e13f2f1e4bc_720w.jpg?source=172ae18b" class="bookmark-image"/></a></figure><figure id="248b7520-5613-45a8-9655-7de7ba5255d1"><a href="https://zhuanlan.zhihu.com/p/546697260" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">CUDAç¼–ç¨‹å…¥é—¨ä¹‹æ¿€æ´»å‡½æ•°Softmax</div><div class="bookmark-description">ä¸Šä¸€ç¯‡ï¼š CUDAç¼–ç¨‹å…¥é—¨ä¹‹æ¿€æ´»å‡½æ•°Swishå®šä¹‰Softmaxå‡½æ•°å¸¸åœ¨ç¥ç»ç½‘ç»œè¾“å‡ºå±‚å……å½“æ¿€æ´»å‡½æ•°ï¼Œå°†è¾“å‡ºå±‚çš„å€¼é€šè¿‡æ¿€æ´»å‡½æ•°æ˜ å°„åˆ°0-1åŒºé—´ï¼Œå°†ç¥ç»å…ƒè¾“å‡ºæ„é€ æˆæ¦‚ç‡åˆ†å¸ƒï¼Œç”¨äºå¤šåˆ†ç±»é—®é¢˜ä¸­ï¼ŒSoftmaxæ¿€æ´»å‡½æ•°æ˜ å°„å€¼è¶Šå¤§ï¼Œåˆ™â€¦</div></div><div class="bookmark-href"><img src="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.81060cab.png" class="icon bookmark-icon"/>https://zhuanlan.zhihu.com/p/546697260</div></div><img src="https://pic1.zhimg.com/v2-90b75c5d6ebc3c472c127e00702d8a43_720w.jpg?source=172ae18b" class="bookmark-image"/></a></figure><p id="6680c4f4-bbc0-41fa-a8f3-9d429ee46d66" class="">
</p><h2 id="c930907b-d144-4aab-8388-ae726ae858f4" class="">Bias_GeLU</h2><p id="536e615e-e324-4528-a8d1-c682a441a5d1" class="">ä¸åŒçš„æ¡†æ¶å¯¹æ¿€æ´»å‡½æ•°çš„å®ç°å¯èƒ½ä¸å®Œå…¨ä¸€æ ·ï¼Œä¸»è¦åŸå› æ˜¯ä»<mark class="highlight-red">ä¼˜åŒ–å‰å‘åå‘è®¡ç®—é‡ä¸å¤æ‚åº¦ã€ä¼˜åŒ–å†…å­˜è®¿é—®é¢‘ç‡çš„å¸¦å®½åˆ©ç”¨ç‡ã€æå‡æ•°å€¼è®¡ç®—ç»“æœç¨³å®šæ€§è§’åº¦</mark>è€ƒè™‘ã€‚</p><p id="26ca5ee0-415e-41f6-8da8-3e592814ef4e" class="">ä¾‹å¦‚ï¼ŒGeLUçš„å®ç°ï¼š</p><ul id="e05c7e01-0bd2-43af-a468-d7df6cbbb390" class="bulleted-list"><li style="list-style-type:disc">åŸå§‹ï¼š<figure id="a2f0e31f-d292-4e9e-8c68-a27556c5defa" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><mi>E</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0.5</mn><mo>âˆ—</mo><mi>x</mi><mo>âˆ—</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>T</mi><mi>a</mi><mi>n</mi><mi>h</mi><mo stretchy="false">(</mo><msqrt><mrow><mn>2</mn><mi mathvariant="normal">/</mi><mi>Ï€</mi></mrow></msqrt><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mn>0.044715</mn><mo>âˆ—</mo><msup><mi>x</mi><mn>3</mn></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">GELU(x)=0.5*x*(1+Tanh(\sqrt{2/\pi}*(x+0.044715*x^3)))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">GE</span><span class="mord mathnormal" style="margin-right:0.10903em;">LU</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.2561em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">anh</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9839em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord">2/</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span></span></span><span style="top:-2.9439em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2561em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.044715</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)))</span></span></span></span></span></div></figure></li></ul><ul id="ed405bc1-d7f4-4505-8fba-e58cd74b3309" class="bulleted-list"><li style="list-style-type:disc">BERTï¼š</li></ul><figure id="62bf52e3-5b02-4a5b-85af-11ae90a3c16e" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><mi>E</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0.5</mn><mo>âˆ—</mo><mi>x</mi><mo>âˆ—</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>t</mi><mi>o</mi><mi>r</mi><mi>c</mi><mi>h</mi><mi mathvariant="normal">.</mi><mi>e</mi><mi>r</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mi mathvariant="normal">/</mi><msqrt><mn>2</mn></msqrt><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>t</mi><mi>o</mi><mi>r</mi><mi>c</mi><mi>h</mi><mi mathvariant="normal">.</mi><mi>e</mi><mi>r</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>2</mn><msqrt><mi>Ï€</mi></msqrt></mfrac><msubsup><mo>âˆ«</mo><mn>0</mn><mi>x</mi></msubsup><msup><mi>e</mi><mrow><mo>âˆ’</mo><msup><mi>t</mi><mn>2</mn></msup></mrow></msup><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">GELU(x)=0.5*x*(1+torch.erf(x/\sqrt 2))\\
torch.erf(x)=\frac {2} {\sqrt {\pi}}\int_0^x e^{-t^2}dt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">GE</span><span class="mord mathnormal" style="margin-right:0.10903em;">LU</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2061em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">orc</span><span class="mord mathnormal">h</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9561em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;">2</span></span><span style="top:-2.9161em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.0839em;"><span></span></span></span></span></span><span class="mclose">))</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">orc</span><span class="mord mathnormal">h</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3443em;vertical-align:-0.93em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.3097em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8003em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span></span></span><span style="top:-2.7603em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2397em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">âˆ«</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4143em;"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.8129em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0369em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span></span></span></div></figure><p id="e3d08bf3-d0f1-4e4e-8d28-1559d413c1b1" class="">ä¸Layernormå’Œsoftmaxï¼Œä¹Ÿæ˜¯<mark class="highlight-red">æ¶‰åŠåœ¨é«˜ç»´çš„hidden sizeç»´åº¦æ±‚æŒ‡æ•°ã€æ±‚å’Œçš„æ“ä½œ</mark>ï¼Œfused kernelæ€è·¯ä¸€è‡´ã€‚</p><ul id="c143fe5b-aafe-47d1-bf93-882c4b630bdb" class="bulleted-list"><li style="list-style-type:disc">æ ¹æ®ç»´åº¦é€‰æ‹©ä¸åŒçš„å¹¶è¡Œç²’åº¦è®¡ç®—</li></ul><ul id="16d8eb05-619b-4c96-8914-fe20d63901f2" class="bulleted-list"><li style="list-style-type:disc">åˆ©ç”¨shared memoryæé«˜è®¿å­˜é€Ÿåº¦</li></ul><ul id="938fa782-9a1d-4fe1-8b9c-67dd4accd5ec" class="bulleted-list"><li style="list-style-type:disc">VMA</li></ul><p id="24da7719-85f4-4566-a24d-297f196dc44b" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>